<?xml version="1.0" encoding="UTF-8"?>

<project name="Distributed Debugger Prototype 1" default="all" basedir=".">
	
	<property name="jar-dir" location="lib"/>
	<property name="src-dir" location="src"/>
	<property name="bin-dir" location="bin"/>

	<property name="client-agent-mainclass" value="ddproto1.localagent.instrumentation.java5.ClientSideAgent"/>
	<property name="agent-library-list" value="bcel-5.1.jar log4j-1.2.9.jar local-agent.jar"/>
	<property name="local-agent-subdir" value="ddproto1/localagent"/>
	
	<property name="commons-subdir" value="ddproto1/commons"/>
	<property name="configurator-commons-subdir" value="ddproto1/configurator/commons"/>
	<property name="exception-commons-subdir" value="ddproto1/exception/commons"/>
	<property name="util-commons-subdir" value="ddproto1/util/commons"/>
	<property name="traits-commons-subdir" value="ddproto1/util/traits/commons"/>
	<property name="collections-commons-subdir" value="ddproto1/util/collection/commons"/>
	
	<target name="prepare">
		<mkdir dir="${jar-dir}"/>
	</target>
	
	<!-- Generates the client side instrumentation agent jar. -->	
	<target name="gen-client-agent-jar" depends="prepare">
		<jar destfile="${jar-dir}/local-agent.jar">
			<manifest>
				<attribute name="Built-By" value="${user.name}"/>
				<attribute name="Premain-Class" value="${client-agent-mainclass}"/>
				<attribute name="Boot-Class-Path" value="${agent-library-list}"/>
				<attribute name="Can-Redefine-Classes" value="true"/>
			</manifest>
			
			<zipfileset dir="${bin-dir}/${local-agent-subdir}" 
				includes="**/*.class" prefix="${local-agent-subdir}"/>
			
			<zipfileset dir="${bin-dir}/${commons-subdir}" 
				includes="**/*.class" prefix="${commons-subdir}"/>
			
			<zipfileset dir="${bin-dir}/${configurator-commons-subdir}" 
				includes="**/*.class" prefix="${configurator-commons-subdir}"/>			
			
			<zipfileset dir="${bin-dir}/${exception-commons-subdir}" 
				includes="**/*.class" prefix="${exception-commons-subdir}"/>
			
			<zipfileset dir="${bin-dir}/${util-commons-subdir}" 
				includes="**/*.class" prefix="${util-commons-subdir}"/>

			<zipfileset dir="${bin-dir}/${traits-commons-subdir}" 
				includes="**/*.class" prefix="${traits-commons-subdir}"/>
			
			<zipfileset dir="${bin-dir}/${collections-commons-subdir}" 
				includes="**/*.class" prefix="${collections-commons-subdir}"/>
		</jar>
	</target>	
	
	<!-- Generates the server-side derived jar file w/o any interface -->
	<target name="gen-server-jar" depends="prepare">
		<jar destfile="${jar-dir}/god.jar">
			<!-- Includes everything except the console code and the local agent code. -->
			<fileset dir="${bin-dir}">
				<include name="ddproto1/**/*.class"/>
				<exclude name="ddproto1/localagent/**"/>
				<exclude name="ddproto1/*.class"/>
<!-- 				<exclude name="ddproto1/**/*Test*"/> -->
			</fileset>
		</jar>
	</target>
	
	<!-- Generates the console jar file. -->
	<target name="gen-console-jar" depends="gen-server-jar">
		<jar destfile="${jar-dir}/god-console.jar">
			<fileset dir="${bin-dir}">
				<include name="ddproto1/*.class"/>
			</fileset>
		</jar>
	</target>
	
	<target name="all" depends="gen-client-agent-jar, gen-console-jar"/>
</project>